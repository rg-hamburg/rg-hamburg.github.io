{% assign slug = page.data_key %}
{% assign img_prefix = slug | append: "_" %}
{% assign carousel_imgs = "" | split: "," %}
{% for f in site.static_files %}
  {% if f.path contains "/assets/images/impressions/" %}
    {% if f.name contains img_prefix %}
      {% assign carousel_imgs = carousel_imgs | push: f.name %}
    {% endif %}
  {% endif %}
{% endfor %}

{% if carousel_imgs.size > 0 %}
{% assign carousel_id = "impressionsCarousel-" | append: slug %}
<section class="impressions-section bg-rg-light">
  <div class="container">

    <div class="section-header mb-section-head">
      <span class="section-label">Impressionen</span>
      <div class="section-line"></div>
    </div>

    <div id="{{ carousel_id }}" class="carousel slide impressions-carousel" data-bs-ride="false">
      <div class="carousel-inner">
        {% assign slides_count = carousel_imgs.size | plus: 2 | divided_by: 3 %}
        {% for slide_i in (1..slides_count) %}
          {% assign offset = forloop.index0 | times: 3 %}
          {% assign slide_imgs = carousel_imgs | slice: offset, 3 %}
          <div class="carousel-item{% if forloop.first %} active{% endif %}">
            <div class="row g-3">
              {% for img_name in slide_imgs %}
              <div class="col-4">
                <img src="{{ site.baseurl }}/assets/images/impressions/{{ img_name }}"
                     class="impressions-carousel-img"
                     alt="Impression {{ offset | plus: forloop.index }}">
              </div>
              {% endfor %}
            </div>
          </div>
        {% endfor %}
      </div>
      <button class="carousel-control-prev impressions-ctrl" type="button"
              data-bs-target="#{{ carousel_id }}" data-bs-slide="prev" aria-label="ZurÃ¼ck">
        <svg viewBox="0 0 24 24" fill="currentColor" width="32" height="32">
          <path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"/>
        </svg>
      </button>
      <button class="carousel-control-next impressions-ctrl" type="button"
              data-bs-target="#{{ carousel_id }}" data-bs-slide="next" aria-label="Weiter">
        <svg viewBox="0 0 24 24" fill="currentColor" width="32" height="32">
          <path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"/>
        </svg>
      </button>
    </div>

  </div>
</section>
{% endif %}

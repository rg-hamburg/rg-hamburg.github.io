---
layout: default
---

<section class="page-hero">
  <img src="{{ site.baseurl }}/assets/images/{{ page.hero_image }}"
       class="page-hero-bg" alt="Aktuelles RG Hamburg">
  <div class="page-hero-overlay"></div>
  <div class="container h-100 position-relative">
    <div class="page-hero-title-box">
      <h1 class="page-hero-title">Aktuelles</h1>
    </div>
  </div>
</section>

{% include events.html %}

{% include news.html %}

<div id="aktuelles-pagination" class="bg-rg-light py-4 d-flex justify-content-center align-items-center gap-3" style="display:none"></div>

<script>
document.addEventListener('DOMContentLoaded', function () {
  var PAGE1 = 4, PAGEN = 8;
  var allCards      = Array.from(document.querySelectorAll('[data-post-idx]'));
  var eventsSection = document.getElementById('veranstaltungen');
  var pager         = document.getElementById('aktuelles-pagination');
  var filterBtns    = Array.from(document.querySelectorAll('[data-filter-tag]'));
  var activeTag     = null;
  var page          = 1;
  var totalPages    = 1;

  function getFilteredCards() {
    if (!activeTag) return allCards;
    return allCards.filter(function (c) { return c.dataset.tag === activeTag; });
  }

  function buildUrl(p, tag) {
    var params = new URLSearchParams();
    if (tag) params.set('tag', tag);
    if (p > 1) params.set('page', String(p));
    var qs = params.toString();
    return location.pathname + (qs ? '?' + qs : '');
  }

  function show(p, skipPush) {
    var cards = getFilteredCards();
    var count = cards.length;
    totalPages = count <= PAGE1 ? 1 : 1 + Math.ceil((count - PAGE1) / PAGEN);

    p = Math.min(Math.max(p, 1), totalPages);
    page = p;

    if (eventsSection) {
      eventsSection.style.display = (!activeTag && p === 1) ? '' : 'none';
    }

    var start, end;
    if (p === 1) {
      start = 0;
      end = PAGE1;
    } else {
      start = PAGE1 + (p - 2) * PAGEN;
      end = start + PAGEN;
    }

    allCards.forEach(function (c) { c.style.display = 'none'; });
    cards.forEach(function (c, i) {
      c.style.display = (i >= start && i < end) ? '' : 'none';
    });

    renderPager();

    if (!skipPush) {
      window.scrollTo({ top: 0, behavior: 'smooth' });
      history.pushState({ page: p, tag: activeTag }, '', buildUrl(p, activeTag));
    }
  }

  function mkBtn(label, targetPage) {
    var el = document.createElement('button');
    el.textContent = label;
    el.className = 'pager-link';
    el.onclick = function () { show(targetPage); };
    return el;
  }

  function renderPager() {
    if (totalPages <= 1) { pager.style.display = 'none'; return; }
    pager.style.display = 'flex';
    pager.innerHTML = '';
    if (page > 1) pager.appendChild(mkBtn('← Neuere', page - 1));
    var info = document.createElement('span');
    info.style.color = 'var(--rg-text-grey)';
    info.textContent = 'Seite ' + page + ' von ' + totalPages;
    pager.appendChild(info);
    if (page < totalPages) pager.appendChild(mkBtn('Ältere →', page + 1));
  }

  function applyFilter(tag) {
    activeTag = tag || null;
    filterBtns.forEach(function (btn) {
      btn.classList.toggle('active', btn.dataset.filterTag === (tag || ''));
    });
    show(1);
  }

  filterBtns.forEach(function (btn) {
    btn.addEventListener('click', function () {
      applyFilter(btn.dataset.filterTag);
    });
  });

  /* --- Init from URL --- */
  var params   = new URLSearchParams(location.search);
  var initTag  = params.get('tag') || null;
  var initPage = parseInt(params.get('page')) || 1;

  if (initTag) {
    activeTag = initTag;
    filterBtns.forEach(function (btn) {
      btn.classList.toggle('active', btn.dataset.filterTag === initTag);
    });
  }

  history.replaceState({ page: initPage, tag: activeTag }, '', location.href);
  show(initPage, true);

  window.addEventListener('popstate', function (e) {
    if (e.state) {
      activeTag = e.state.tag || null;
      filterBtns.forEach(function (btn) {
        btn.classList.toggle('active', btn.dataset.filterTag === (activeTag || ''));
      });
      show(e.state.page || 1, true);
    }
  });
});
</script>

{% include probetraining.html %}
